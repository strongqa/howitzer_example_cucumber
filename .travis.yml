language: ruby
dist: trusty
sudo: required

# Bundler and ruby caching
cache:
 - bundler
 - directories:
   - "/home/travis/.rvm/"
addons:
  chrome: stable
rvm:
  - 2.6.2
apt:
  sources:
    - ubuntu-sdk-team
  packages:
    - qt5-default
    - libqt5webkit5-dev
    - gstreamer1.0-plugins-base
    - gstreamer1.0-tools
    - gstreamer1.0-x

before_install:
  - sudo apt-get update -qq
  - sudo apt-get install -y -qq postfix
  - sudo apt-get install -y dpkg
  - sudo apt-get --only-upgrade install google-chrome-stable
  - google-chrome --version

install: bundle install --jobs=3 --retry=3 --with webkit
env:
  matrix:
    - secure: "EnztvYGB7JgohVEpuzgM8axgdmOANip+hinvp2AT8Uy3fle3mzx5RuB4aFheNoPHW2RgfOcsWtHtH/z4LnEiiYyk/8xc5kDCpbD/Q1FVnFpo1zmHByegebpxXhhOs1H4lMpwh8wNv1kdfQ/Koy8RBn2CHXQ4089uFyIplXYflEqEoZgiKgBcdZK2c+cUeCSk+tnsWizM07yCB885S8/au1dx688jSiYdaVbH48AznnAZenXq7XY4Aqd1KaKH31aT/Uf1bSaRYvBDozAZaTjb5/JsrTEdfLrxvHfLpEypCqX6CjOpsU4BeuTZtbWy4Bcw/pYneJ3pZImmdNQP6BuCt+vlCitgv2SXixMp0cXIXRiM9XAFb9u4nUbqckLC06U5FE9q5NKvp7B90AwqSZW7RM8PTHo3hg3Az/bYCXD9Y3/45dplQ0SPDptvE8UpNlDBg9cxdsNfDPooUwoAdNltGAizHER72u7aw+hySOu1uzPlGT40Qy0+dfMIENLQKqTF9Q53R0ud9BCiOa/a6kJN9HHjuTkqhssDRPvq+UGm6L5eOAlYyJgBlya6KT5ND/j/ls79EVJB7sEscPvc/6WK9BBFoB6neAk+VbVnfTtMtwXYrvjDYMFXFXFqYoF1uWOrWxvspAY7Grkr3niBmnvopKj8MFLeTwnLR1tp0zqwp4Y=" #driver=poltergeist
    - secure: "A6lewLaPmy6dqaSB30AfTxOdVXO4pjmerkiKCORLYT+CXa9QRbTvlABdGzkKLCbVNO5GrWI3cqg25n7CisSbKgZGthA6LnneyRK4my8IvMsMDK6zqWyxv3Z0mKFR89ClD0SAzO+qeh/aiKuPuUVPTz7HFR2GwvQlMGYSZhc2p/McWUJvcQOI56QakNdIyVoi1ZQkVeeh8+vQm593wAjs9qzmARvNWRfDay40xN4WOj9DSnylrbFWo7gGIcMihkC076fhY8g3TYNZrC35op3R/+nxZGzlo8RR1Gz5xrROaPLdSx5uZgWI/tfskL3976GXBFPSa+Ih3LBCVL2a82gXre4EcW8m5HgErqeBLQd5wypAw3PeRabYG0P1eUWmDpfYAENLpTzQnblri4d2yETwVH5EyQDBolc5ybDLb4A/khF9etlw+ea5g+udD0h6mLfrNQj43ApyoLsTOl6itwHoebQG9qkpnkbRiQX1ucXu4DAPo3E7gA8WrTjIpKPBTcl46NhtTrfEWptqRJoXpir33PDHKlPy/DlrY/KnzhSiFuDrVWz994cCQTL8BV7BU1ADLQZyp+YEwp9T15A1xdJGJBGO17cgmFF6Jv7BtV0rOMr5NDv5U2qtCLMVvvcCcsboqBBbbhLtDUf34SWFcRnSBPDffTqoZQE9B4LYz/SbD3s=" #driver=headless_chrome
    - secure: "Onht7Hmy+RUjAmO8gp8ASIrJt+PKFrox3U6/sFKsyndNHKhKCI1RdN2mMaKzx0TTM/5lUixvhKO3CCmfGCdC1jjCKrK/4SSItCT7a89HvXvRrFbsoTX1un/nx8YDb3g+uS0C6G+fFf/r+4xI/zgU1QfEENlJjhZN+Hwrhngm5ECnAG89mDOgfZqC9kTMOdn14XPKIQmHZ1fOhvmbOpCah5owckrnbMEUXze/zZEHNndO+h1FWNRiiaAKVKCtsoHYH8wuXrSB8ACOkwNoOG9TaizeJ3LSFgD44ePkoLxFZLFN9SI84k495EQ0BJNxa3YTyPL6/sgF6YYW9wQykbBW1ZdSRxlod57WVBVRSF8IVCtB96e+aIHbDVeVcptkb4GqM71ImQ1jBGcK2mm+9gEKA2eb70gzVQl4kd7d3/byrCOSfp9lMMtjz9qYGBCMIva0iuPqrXAqctb6DNEI5jNaQ02HQnbERebAo4dKRzKkGuWU8fnQd1sHRjliUjPILe/9gQ/2qwdDINT8w/SIVnsFS7FD/FYN9q0KGGNc8AO2b3rIbRw2Zo4EDBHAGaplpOaHReNDqHirmIc2AZjrIYuCEyS6rvSGTZdnUCJts6fQWcqYv8NEZtZUz6B6BdRBtVA9v1KZrZShYVuxPkJkBqfC79DsVww2oBbBcQH1hj6ZoNY=" #driver=webkit
    - secure: "dRL0Y4dwe46GsRc7YU6LTleQ994dvPBPk7eklGqsuP8+deimcO1779gV2TtN+dbjTg9hIIjzRp5f/I+KrL8m9iJFy4XjBtFtBnv4VmAyR0aHWxco+1RNBcmBUxOSxl418H+ifYwyus8mA9ItQohfomsEa1qzxBfVBtEJgI9BVPLPaEJ2YEsFQqfjoeJz+bMcvsdf47foUXWjVmHe0lPyF3cRj8AQzsPQM0FzGLEyqd8gB/JOyuAPmRCVCSPJGvqNpWNa5lO5dfwmRXO/6IJaRIyhczc0qJWqtcbt4ykS3s6xjsJR1aoGXzbYDg8xEUV+iFJ7tEI0O7IEsG5JMDjWGTQelHsfP/zWdMcqfOWcYEr/zhpDoZcJFJ5ZNh1K7zs93W49rTYudGMhaHeo45z4yXIAHUPY2+lEvgvu6Bx9z94tfA88zX43xx3OBeeMrHjJCJHoMdH20iSnH1bqQUgF389VmePp3HUgGxECKSavPjH3Y/sG6Vs5Pzb/iwd8W5GHi/OXlqZAkVPT0zp++LYCNeUOTmWLfuXYDnAIoCOPpT8M2bZlU5RXV+4X6GmOsxAOYCu4S5s+GwpUvXZJfGj9+yzw5SNyzALmjQyA2lFFF41myWbUZL8VpLY0QTAb5I5QfCf0kb4wQsHipByXplNiG2nw9npIgbQUcEewYOW+ddI=" #driver=sauce
    - secure: "DkigmgVTg0pm79sZxG0sX/uA0kfHQ2RdQR2wYHw5BHmrFr7k7c3myfDcvrwmOGgfx2MX8uaatSWsrfFcWNH5LXCaSn/W3pA61RNu4XBhfHTwSXBQrETuxudd9nEdDv7lc8ZyxYXU4/KpkhkACCemDu7em8yPpqUwNCFVZkM69bBczhAsExrJv/N14RwJJ4+45I3NflF9N7yT6/9LaW+y2es0UL7S9YnQT/1TzQ3jTXz13kpG2WPJ+47QwHDQvaZq/xhJP40iM/h5hnlpPw4MA2JlrlVkbS7GXg68SYoPOHJWOReX1VCCfyR1OvlnJxZk6FYrEJTO40Q/vOCiWLMaEBOfFLjQAEjsWJFxNvO3Zwv1wDl7ouJGxlDQbM0rNw3R8SxSzvnb89TturRf1x9jB6DOQT8KV9kIbT9XNp0DuUYLMjRQ5f96ABc5oMZN9ZYnpNz5aDcVdZmSuSReQsuPGyJZW2eD2S5A2IrrSCm+OcjRe13NxKv6QWdspMVy/IY3GHAPUVQ51/nJ4MDgQBZdsMmfAD3/yrEvQL+b1Zy/nJsAPKP+nN4rowSD+WWgrUGSu3ruQFJsr+H1CQqwdoJmXAYdLpu7jJASoFmRirNo3GzvacOCVChBPDxZTXz2+1yNGMWCha/3toe2uw9YAEMPQXGV0Er3KIx/azsH0itELJw=" #driver=testingbot
    - secure: "LGWAKWspJjUTJNxwLk/rqCOtQWlZlaKuQ8mDzMl+GHiKzWqf5yZfq99rbrTdagHDclyuYNGwsYaMTp/r1wYyaGwqi1/u8sbP+v85Hpm9qNlNZ6kzz9BExgPl9EE9isNu0wqcoSu8NMvR7xL/r/yxaYQpw6JU0+X7PB/hjKiLdafwxaH15xV/6btrXHx+PgtPmsXCP74KJG2TdFBEUBjWJG05TjNduxYjyPhX6GNFqgdOpTuvFiWI28t9BLUvx2BiMI9cnt2RIRo+mXQUQixAmp4Hhtm+0fFHHS42kqtmogkladrjzJivN3CcxNmf6CteWSLcGlCR9Oz3sIceC7MhzcHjeBu0zjVnOHIBXMLFInEjfAzJKvLzZ0XHcfYbUCqVKXMF/7i8rkuGGVf5XwcqYjFPGXghKWKc83mH0cFG1bcmq+yRKToop33WC8kvTLCE0TxGleZ+Cwi8EVcyXtwfk/WGQaftypUhP+ETOfg7QCRL/2+wLyxXq+GsdlwvcXS1hF93Cag0woqhkLWzqS9NE5du0ScLnSwT0RIS1qhR1/VyLcb20+wlw5vmiQC1xsPhXhkq62XI7Pka5gSPKRLm168N4W7yB4pQ/lcAnO3kdlO3bVgeCaSvHuHbudez1jXaj3tHv+oTbyMMi602DEHMfu8xqQEkw5AhoInhwLe4WqU=" #driver=browserstack
    - secure: "ecYr2oUvBpvnEaVcJoROO/BjfGo5wpaUe1b63od9ulOa4wbZHvgUSbaWcluh+P517IbIqryBotrr24JVyGGea8LK8SOozXqJ9zjuhccUYdg5Hwwi5IdNAzoOCueTFz5T99b5NbOXA5QdXqz9hBks5GgfRLduzAkagG3tpP2tKmFqYp5+aWUdafud7iUeLPt/NRbqw+b7xvNLPUdPbSXSfB/mnpXhNBVPcYpxRV2C/dzgpz9qkW2oXzjS/st7K8Ob+W5laOROZU+E0m5fp+3qvAmAVSRKKwQKMOPOGqYignGwyZ3Ddho+rBpS8OkWiu9nIt/0ap0Xj96F+IgMBrufsSGx4GeOtDGuVAGOQWm+5aPcWLFull/4VX5LQApgNcxygNkcpyp0yB6VXHWi7egO7lQlWDMh146ZzEF+nEkEkae/o2ou3k4f54t3xS7XGIIFE8GP7t01WcP4tHg1pNfmXxJd0ezapoBE2Ht3k0bcIWDeSQcPJUzJ9wN4/Ed6TgVS5+Hg76c7YknTjdmwS0Hk8hlfvhUdUL2qR7hoq4bxZ5I6qYVjV2N1COSnRUAJrQ8xUsuoRxgIXhhYlC1Z6RLmnOsuf2Hhi5GvgVr6bD9Enyd6rL4Ikw9tzgoNZz4L0fUPMnZgpgcuItvnxZgZw9yN9bxb2HHznoh6TnXRWXxmDlg=" #driver=crossbrowsertesting
    - secure: "hO4sR2WaRx8B6kkI3V9PtoxnaQlZu9ryoRDwO5MyZHZEjsSCatKKjeT0tYiJakiUGDmrOBD0pipzohw6Xmgc0AGMs1LnQJDNvBQS1my7n5uk/C0vM/Yzt599kfTYFnxapHPGxjqM4pnO9Z0Tc29hclFXcCfUf6WNUE6q6n54MddWU1bTfAONE/xOJtXcuKVnJKsRg1V3lvKlBWuiiCIX1WVoxiArFsU27/VPZqwk/7SJksTcNmzs3ayBtsqc00SF3PKJvbZF/vJ3VVA63ofZJejIUCDkyJzennJDE/oeEPtIgbMnK9BrBKeOO0Y0i+gGCERNitbjzv2mGZvCJro6rtJn+0OtqIkuRYb+JtS6Fw7mZqeANLLrEvexbCxnsOM/s7kIK5LIPD27HUJe9q5xBQjjTTDxwdD1gfX1OyrdC+kr/BRVRnpIIzQwwCceurOCrAavr16optJMF/+84te3Of+8HfsHzLFwkOz/C86Vx0Q+nDwhVGviGjjncXEc0loZ2iKcyl+ws4qL2iO+t9LCTZyjDTBsVYCtWNO6js/AuYRLsB8/a2BMvCdrzHi/+nVM735y092nCSF+/J4QP4JRJLJUSfu6h29BEVOndukFDqKlXdDmU32BxqtmDTcJHZYhekVIT8xEazvBWD6JTwuzA+6PZ08jhaqt1x/G2l0cU68=" #driver=apium
script: "./scripts/run-tests.sh"
